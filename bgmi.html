<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BGMI Registration Dashboard - Gaming Thiruvizha</title>
    <style>
        :root {
            /* New User-Defined Color Palette */
            --theme-gold: #facb3f;
            --theme-deep-blue: #1a4992;
            --theme-coral: #f47b5b;
            --theme-orange: #faa64d;
            --theme-pink: #e53b5c;
            --theme-light-blue: #7cd0f5;
            --theme-dark-bg: #0A1931;

            /* Legacy variables for structure (will be overridden by theme colors) */
            --primary-color: var(--theme-deep-blue);
            --accent-yellow: var(--theme-gold);
            --danger: var(--theme-pink);
            --success: var(--theme-light-blue);

            --text-light: #ffffff;
            --text-muted: #cccccc;
            --border-radius: 8px;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            transition: background-image 0.5s ease-in-out;
        }

        /* Different backgrounds for each page */
        body.mode-selection-bg {
            background-image: url('banner.png');
        }

        body.squad-registration-bg,
        body.solo-registration-bg {
            background-color: var(--theme-dark-bg);
        }

        /* Fallback background if no class is set */
        body:not(.mode-selection-bg):not(.squad-registration-bg):not(.solo-registration-bg) {
            background-image: url('banner.png');
            /* Default background */
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px; /* Added padding for smaller screens */
        }

        header {
            background: linear-gradient(175deg, var(--theme-deep-blue), var(--theme-coral), var(--theme-gold), var(--theme-deep-blue));
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite, headerGlow 3s ease-in-out infinite;
            width: 100%; /* Changed from fixed 1200px */
            max-width: 1200px; /* Added max-width */
            height: 200px;
            text-align: center;
            margin: 0 auto 60px auto;
            padding: 50px 20px; /* Adjusted padding */
            border-bottom: 2px solid var(--theme-gold);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        /* Animated gradient background */
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }


        /* Animated overlay effect */
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg,
                    transparent,
                    rgba(255, 255, 255, 0.1),
                    transparent);
            animation: shimmer 6s linear infinite;
        }

        @keyframes shimmer {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Particle effect */
        header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle, rgba(255, 255, 255, 0.3) 1px, transparent 1px),
                radial-gradient(circle, rgba(255, 255, 255, 0.2) 1px, transparent 1px);
            background-size: 50px 50px, 100px 100px;
            background-position: 0 0, 25px 25px;
            animation: particleFloat 20s linear infinite;
            opacity: 0.5;
        }

        @keyframes particleFloat {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(-50px, -50px);
            }
        }

        header h1 {
            font-size: 2.5rem;
            color: var(--theme-dark-bg);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            z-index: 2;
            animation: titleSlideIn 1s ease-out, titleGlow 2s ease-in-out infinite alternate;
            text-shadow:
                0 0 5px var(--theme-gold),
                0 0 15px var(--theme-gold),
                2px 2px 4px rgba(0, 0, 0, 0.5);

        }

        @keyframes titleSlideIn {
            0% {
                opacity: 0;
                transform: translateY(-30px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes titleGlow {
            from {
                text-shadow:
                    0 0 5px var(--theme-gold),
                    0 0 15px var(--theme-gold),
                    2px 2px 4px rgba(0, 0, 0, 0.5);
            }

            to {
                text-shadow:
                    0 0 10px var(--theme-light-blue),
                    0 0 25px var(--theme-light-blue),
                    2px 2px 4px rgba(0, 0, 0, 0.5);
            }
        }

        header p {
            -webkit-text-stroke-width: 1px;
            -webkit-text-stroke: 1px black;
            font-size: 1.2rem;
            position: relative;
            z-index: 2;
            animation: subtitleFadeIn 1.5s ease-out 0.5s both, subtitlePulse 3s ease-in-out infinite;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        @keyframes subtitleFadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }

            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes subtitlePulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.05);
                opacity: 0.9;
            }
        }

        /* NEW Mode Selection Screen - Flexbox for Responsiveness */
        #mode-selection {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin: 50px auto 0 auto;
            display: flex;
            justify-content: space-around; /* Changed for better spacing */
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: 20px;
        }

        /* Logo in the center - Adjusted for Flexbox */
        .center-logo {
            width: 300px;
            height: 300px;
            object-fit: contain;
            animation: pulse 2s infinite;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
            z-index: 10;
            order: 2; /* Default order for desktop */
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Mode Card Container - Contains both background and card */
        .mode-card-container {
            position: relative; /* Changed from absolute */
            width: 350px;
            height: 500px;
        }
        
        /* Set order for squad and solo cards */
        .mode-card-container.squad-container { order: 1; }
        .mode-card-container.solo-container { order: 3; }


        /* Background Box - Shows on Hover */
        .mode-card-bg {
            position: absolute;
            width: 350px;
            height: 200px;
            border-radius: 25px;
            opacity: 1;
            transition: all 0.4s ease;
            transform: translateX(0) translateY(0);
        }

        /* Squad Mode Background Box */
        .squad-container .mode-card-bg {
            background: linear-gradient(135deg, var(--theme-coral), var(--theme-orange));
            top: 0px;
            left: 0px;
        }

        /* Solo Mode Background Box */
        .solo-container .mode-card-bg {
            background: linear-gradient(135deg, var(--theme-light-blue), var(--theme-deep-blue));
            top: 0px;
            left: 0px;
        }

        /* Show background on container hover */
        .mode-card-container:hover .mode-card-bg {
            opacity: 1;
            transform: translateX(0px) translateY(-2.1rem);
        }

        /* Main Mode Card - Hardcoded Size */
        .mode-card {
            position: absolute;
            background: #ffffff;
            border-radius: 20px 20px 60px 20px;
            width: 330px;
            height: 480px;
            padding: 0;
            text-align: left;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid #f0f0f0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: visible;
            display: flex;
            flex-direction: column;
            z-index: 5;
            top: 10px;
            left: 10px;
        }

        .mode-card-container:hover .mode-card {
            transform: translateY(-20px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
        }

        /* Card Header with Icon - Hardcoded Padding */
        .mode-card-header {
            padding: 30px;
            padding-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .mode-card-icon {
            position: relative;
            top: -1px;
            left: -15px;
            width: 80px;
            height: 80px;
            border-radius: 20%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Squad Mode Styling */
        .squad-container .mode-card-icon {
            background: linear-gradient(135deg, var(--theme-coral), var(--theme-pink));
        }

        .squad-container .mode-card-title {
            color: var(--theme-coral);
            font-size: 24px; /* MODIFIED */
        }

        .squad-container .mode-number {
            background: linear-gradient(135deg, var(--theme-coral), var(--theme-pink));
        }

        .squad-container .mode-card-features li:before {
            color: var(--theme-coral);
        }

        /* Solo Mode Styling */
        .solo-container .mode-card-icon {
            background: linear-gradient(135deg, var(--theme-light-blue), var(--theme-deep-blue));
        }

        .solo-container .mode-card-title {
            color: var(--theme-deep-blue);
            font-size: 24px; /* MODIFIED */
        }

        .solo-container .mode-number {
            background: linear-gradient(135deg, var(--theme-light-blue), var(--theme-deep-blue));
        }

        .solo-container .mode-card-features li:before {
            color: var(--theme-light-blue);
        }

        .mode-card-icon img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            filter: brightness(0) invert(1);
        }

        /* Card Content - Hardcoded Padding */
        .mode-card-content {
            padding: 0 30px 30px 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .mode-card-title {
            position: relative;
            top: -95px;
            left: 25px;
            font-size: 22px; /* Base font size, will be overridden */
            font-weight: 700;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: left; /* Add this line */
        }

        .mode-card-subtitle {
            position: relative;
            top: -95px;
            left: 75px;
            color: #7f8c8d;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .mode-card-description {
            position: relative;
            top: -95px;
            left: 5px;
            color: #555;
            line-height: 1.6;
            font-size: 14px;
            margin-bottom: 20px;
            min-height: 80px;
        }

        .mode-card-features {
            position: relative;
            top: -95px;
            left: 5px;
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }

        .mode-card-features li {
            position: relative;
            padding-left: 25px;
            margin-bottom: 8px;
            color: #666;
            font-size: 13px;
        }

        .mode-card-features li:before {
            content: "✓";
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        /* Select Button - Fixed Size */
        .mode-select-btn {
            position: relative;
            top: -95px;
            left: -3px;
            color: var(--text-light);
            border: 2px solid;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 270px;
            margin: 0 auto;
        }

        .squad-container .mode-select-btn {
            background-color: var(--theme-coral);
            border-color: var(--theme-pink);
        }

        .squad-container .mode-select-btn:hover {
            background: var(--theme-pink);
            transform: scale(1.05);
        }

        .solo-container .mode-select-btn {
            background-color: var(--theme-deep-blue);
            border-color: var(--theme-light-blue);
        }

        .solo-container .mode-select-btn:hover {
            background: var(--theme-light-blue);
            color: var(--theme-dark-bg);
            transform: scale(1.05);
        }

        /* Mode Number Circle - Fixed Position */
        .mode-number {
            position: absolute;
            bottom: -25px;
            left: 135px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        /* Cancel button styling */
        .cancel-btn {
            background-color: var(--theme-pink);
            margin-left: 20px;
        }

        .cancel-btn:hover {
            box-shadow: 0 0 15px var(--theme-pink);
        }

        /* Button container for back and cancel */
        .button-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap; /* Allow buttons to wrap on small screens */
            gap: 10px;
        }

        .registration-page h2 {
            color: var(--theme-gold);
            font-size: 2.2rem;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 0 10px var(--theme-gold);
        }

        .mode-description {
            color: var(--text-muted);
            font-size: 1.1rem;
            text-align: center;
            max-width: 800px;
            margin: 0 auto 20px auto;
        }

        /* --- SQUAD REGISTRATION --- */
        #squad-registration {
            display: none;
        }

        .slots-container {
            display: grid;
            /* Responsive grid columns */
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 35px;
            margin-top: 30px;
            justify-content: center;
        }

        .slot {
            background: #141829;
            border-radius: var(--border-radius);
            width: 100%; /* Changed from fixed 320px */
            height: 280px;
            padding: 20px;
            text-align: center;
            position: relative;
            border: 1px solid var(--theme-deep-blue);
            transition: all 0.3s ease;
            overflow: hidden;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .slot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, var(--theme-coral), transparent 60%);
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
            opacity: 0;
        }

        .slot:hover {
            transform: translateY(-10px);
            border-color: var(--theme-coral);
            box-shadow: 0 0 25px var(--theme-coral);
        }

        .slot:hover::before {
            width: 400px;
            height: 400px;
            opacity: 0.1;
        }

        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            background-color: #000;
            padding: 8px 12px;
            border-radius: 4px;
            position: relative;
        }

        .slot-number {
            background-color: var(--theme-coral);
            color: #000;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            position: relative;
        }

        .slot-team-name {
            font-size: 1.2rem;
            color: var(--theme-gold);
            text-transform: uppercase;
            font-weight: 700;
        }

        .slot-team-name.empty {
            color: #666;
        }

        .player-pods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            height: 100px;
            /* Fixed height for pods container */
        }

        .player-pod {
            background: #232842;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid #444;
            height: 45px;
            /* Fixed height for each pod */
            display: flex;
            align-items: center;
        }

        .player-pod.filled {
            border-left-color: var(--theme-light-blue);
        }

        .player-pod-ign {
            font-size: 0.9rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .add-team-btn {
            background: transparent;
            border: 2px solid var(--theme-coral);
            color: var(--theme-coral);
            width: 100%;
            height: 150px;
            border-radius: 5px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .add-team-btn:hover {
            background: var(--theme-coral);
            color: #000;
        }

        .slot-filled-content {
            display: none;
            /* Hidden by default */
        }

        .slot.filled .slot-filled-content {
            display: block;
            /* Shown for filled slots */
        }

        .edit-roster-btn {
            margin-top: 15px;
            background: var(--theme-gold);
            color: #000;
            border: none;
            padding: 12px 15px;
            width: 100%;
            height: 45px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        .slot.filled .add-team-btn {
            display: none;
        }

        .slot-booked-status {
            display: none;
            /* Hide by default */
            color: var(--theme-light-blue);
            font-weight: bold;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .slot.filled .slot-booked-status {
            display: block;
            /* Show when filled */
        }


        /* --- SOLO REGISTRATION --- */
        #solo-registration {
            display: none;
        }

        .solo-slots-container {
            display: grid;
            /* Responsive grid columns */
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 30px;
            margin-top: 30px;
            justify-content: center;
        }

        .solo-slot {
            --angle: 0deg;
            position: relative;
            padding: 2px;
            width: 100%; /* Changed from fixed 220px */
            aspect-ratio: 1 / 1; /* Maintain square shape */
            border-radius: 12px;
            cursor: pointer;
            background: conic-gradient(from var(--angle),
                    var(--theme-dark-bg),
                    var(--theme-dark-bg),
                    var(--theme-dark-bg),
                    var(--theme-light-blue),
                    var(--theme-light-blue),
                    var(--theme-light-blue),
                    var(--theme-dark-bg),
                    var(--theme-dark-bg));
            animation: 3s rotate linear infinite;
        }

        .solo-slot:hover {
            animation: 1s rotate linear infinite;
        }

        @keyframes rotate {
            to {
                --angle: 360deg;
            }
        }

        .solo-slot-inner {
            background-color: #0F1634;
            background-image: linear-gradient(rgba(124, 208, 245, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(124, 208, 245, 0.05) 1px, transparent 1px);
            background-size: 25px 25px;
            border-radius: 10px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .solo-slot:hover .solo-slot-inner {
            background-color: var(--theme-deep-blue);
        }

        .solo-slot-number {
            position: absolute;
            top: -1px;
            left: -1px;
            background-color: var(--theme-light-blue);
            color: #000;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 1rem;
            clip-path: polygon(0 0, 100% 0, 100% 70%, 50% 100%, 0 70%);
        }

        .add-player-btn {
            background: transparent;
            border: none;
            color: var(--theme-light-blue);
            width: 100px;
            height: 100px;
            font-size: 5rem;
            font-weight: 100;
            cursor: pointer;
            transition: all 0.3s;
            text-shadow: 0 0 15px var(--theme-light-blue);
            animation: pulse-glow 2s infinite ease-in-out;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.8;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }


        .solo-slot.filled .add-player-btn {
            display: none;
        }

        .solo-player-info {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 10px;
            text-align: center;
            position: relative;
        }

        .solo-slot.filled .solo-player-info {
            display: flex;
        }

        .solo-player-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--theme-light-blue);
            border: 2px solid var(--text-light);
            padding: 3px;
        }

        .solo-player-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .solo-player-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--theme-gold);
            text-transform: uppercase;
        }

        .edit-player-btn {
            background: var(--theme-gold);
            color: #000;
            border: none;
            padding: 5px 20px;
            width: 80px;
            height: 28px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8rem;
            cursor: pointer;
            text-transform: uppercase;
        }
        
        /* Added for solo slot booked status */
        .solo-slot .slot-booked-status {
             margin-top: 8px;
        }


        /* Complete Registration Section */
        .complete-registration-container {
            width: 100%; /* Changed from fixed 1200px */
            max-width: 1200px;
            min-height: 150px; /* Use min-height */
            margin: 40px auto 0 auto;
            text-align: center;
            padding: 20px;
            background-image: url('complete-registration.png');
            background-size: cover; /* Ensure BG covers area */
            background-position: center;
            border: 1px solid var(--theme-deep-blue);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .complete-btn {
            background-color: var(--theme-pink);
            font-size: 1.6rem;
            padding: 15px 40px;
            margin-bottom: 15px;
        }
        
        .complete-btn:hover {
            box-shadow: 0 0 20px var(--theme-pink);
        }

        .btn {
            color: var(--text-light);
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: scale(1.05);
        }
        
        .back-btn {
            background-color: var(--theme-deep-blue);
        }
        .back-btn:hover {
            box-shadow: 0 0 15px var(--theme-deep-blue);
        }


        /* MODALS */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 30px 15px;
        }

        .modal-content {
            background-color: var(--theme-dark-bg);
            border: 1px solid var(--theme-deep-blue);
            border-radius: var(--border-radius);
            width: 95%; /* Use percentage width */
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
            position: relative;
            box-shadow: 0 0 25px var(--theme-deep-blue);
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: var(--theme-pink);
        }

        .modal-title {
            text-align: center;
            color: var(--theme-gold);
            margin-bottom: 30px;
            font-size: 1.8rem;
            border-bottom: 2px solid var(--theme-gold);
            padding-bottom: 15px;
        }


        .registration-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .player-section {
            background-color: rgba(0,0,0,0.3);
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid var(--theme-deep-blue);
        }

        .player-section h3 {
            color: var(--theme-light-blue);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--theme-deep-blue);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-muted);
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            background-color: #0A1931;
            border: 1px solid var(--theme-deep-blue);
            color: var(--text-light);
            font-size: 1rem;
        }

        .form-group input:focus {
            border-color: var(--theme-gold);
            outline: none;
            box-shadow: 0 0 10px var(--theme-gold);
        }

        .required {
            color: var(--theme-coral);
        }

        .form-actions {
            text-align: center;
            margin-top: 20px;
        }

        .submit-btn {
            background-color: var(--theme-deep-blue);
        }
        
        .submit-btn:hover {
            background-color: var(--theme-light-blue);
            color: #000;
        }

        #solo-registration-modal .modal-content {
            max-width: 500px;
        }

        #export-modal .modal-content {
            max-width: 600px;
        }

        .export-options {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Allow wrapping */
            gap: 20px;
            margin-top: 30px;
        }

        .export-btn {
            padding: 15px 30px;
            font-size: 1.1rem;
        }

        .json-btn {
            background-color: var(--theme-deep-blue);
        }

        .csv-btn {
            background-color: var(--theme-coral);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 20px; /* Positioned to the left for better visibility on mobile */
            right: 20px;
            width: auto;
            max-width: 400px;
            background-color: var(--theme-light-blue);
            color: #000;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(20px);
            z-index: 2000;
            font-weight: bold;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.error {
            background-color: var(--theme-pink);
            color: var(--text-light);
        }

        /* --- RESPONSIVE DESIGN STYLES --- */
        
        /* For Tablets and smaller desktops */
        @media (max-width: 1024px) {
            #mode-selection {
                flex-direction: column; /* Stack cards vertically */
                gap: 50px;
            }
            .center-logo {
                order: 1; /* Logo on top */
                width: 250px;
                height: 250px;
            }
            .mode-card-container.squad-container { order: 2; }
            .mode-card-container.solo-container { order: 3; }
        }

        /* For smaller tablets and mobile phones */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            header {
                padding: 40px 15px;
                margin-bottom: 40px;
                height: auto;
            }
            header h1 {
                font-size: 2rem;
            }
            header p {
                font-size: 1rem;
            }
            .button-container {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            .cancel-btn {
                margin-left: 0;
                width: 100%;
            }
            .registration-page h2 {
                font-size: 1.8rem;
            }
            .mode-description {
                font-size: 1rem;
            }
            .complete-btn {
                font-size: 1.3rem;
                padding: 15px 30px;
            }
            .modal-content {
                padding: 20px 15px;
            }
        }
        
        /* For mobile phones */
        @media (max-width: 480px) {
             #mode-selection {
                gap: 30px; /* Reduce gap between cards */
             }
            .center-logo {
                width: 200px;
                height: 200px;
            }
             .mode-card-container, .mode-card-bg, .mode-card {
                width: 100%; /* Make cards full width */
                max-width: 330px; /* Keep max-width for consistency */
                left: 0;
                right: 0;
                margin: 0 auto;
             }
             .mode-card {
                left: 5px; /* Adjust card position slightly */
             }
             .mode-select-btn {
                width: 100%;
                max-width: 270px;
             }
            .player-pods {
                grid-template-columns: 1fr; /* Stack player pods vertically */
                height: auto;
            }
            .slot {
                height: auto; /* Auto height for squad slot */
                padding-bottom: 80px; /* Add padding to avoid button overlap */
            }
            .edit-roster-btn {
                position: absolute;
                bottom: 20px;
                left: 20px;
                width: calc(100% - 40px);
            }
        }
    </style>
</head>

<body class="registration-page">
    <div class="container">
        <header>
            <h1>BGMI Registration Dashboard</h1>
            <p>Gaming Thiruvizha - From Street to Stage !!</p>
        </header>

        <!-- Mode Selection Screen -->
        <div id="mode-selection">
            <!-- Squad Mode Container -->
            <div class="mode-card-container squad-container" id="squad-mode">
                <!-- Background Box for Hover Effect -->
                <div class="mode-card-bg"></div>

                <!-- Main Card -->
                <div class="mode-card">
                    <div class="mode-card-header">
                        <div class="mode-card-icon">
                            <img src="SquadIcon.png" alt="Squad Mode">
                        </div>
                        <h2 class="mode-card-title">SQUAD MODE</h2>
                        <div class="mode-card-subtitle">TEAM BATTLE</div>
                    </div>
                    <div class="mode-card-content">
                        <p class="mode-card-description">
                            Form a powerful squad of 4 players and dominate the battlefield together.
                            Coordinate strategies, share resources, and fight as one unit against 15 other squads!
                        </p>
                        <ul class="mode-card-features">
                            <li>4 Players per team</li>
                            <li>16 Teams total</li>
                            <li>Winner will be awarded</li>
                            <li>Tpp - Erangel</li>
                        </ul>
                        <button class="mode-select-btn">Select Squad Mode</button>
                    </div>
                    <div class="mode-number">01</div>
                </div>
            </div>

            <!-- Gaming Thiruvizha Logo in Center -->
            <img src="main.png" alt="Gaming Thiruvizha" class="center-logo">

            <!-- Solo Mode Container -->
            <div class="mode-card-container solo-container" id="solo-mode">
                <!-- Background Box for Hover Effect -->
                <div class="mode-card-bg"></div>

                <!-- Main Card -->
                <div class="mode-card">
                    <div class="mode-card-header">
                        <div class="mode-card-icon">
                            <img src="soloicon.png" alt="Solo Mode">
                        </div>
                        <h2 class="mode-card-title">SOLO MODE</h2>
                        <div class="mode-card-subtitle">Individual Battle</div>
                    </div>
                    <div class="mode-card-content">
                        <p class="mode-card-description">
                            Test your individual skills and prove you're the ultimate survivor.
                            Face off against 63 other solo warriors in an intense battle royale experience!
                        </p>
                        <ul class="mode-card-features">
                            <li>Individual gameplay</li>
                            <li>64 Players total</li>
                            <li>Pure skill based</li>
                            <li>Solo champion</li>
                        </ul>
                        <button class="mode-select-btn">Select Solo Mode</button>
                    </div>
                    <div class="mode-number">02</div>
                </div>
            </div>
        </div>

        <!-- Squad Registration Screen -->
        <div id="squad-registration">
            <div class="button-container">
                <button class="btn back-btn" id="back-to-modes-squad">← Back to Mode Selection</button>
                <button class="btn cancel-btn" id="cancel-squad-registration">Cancel Registration</button>
            </div>

            <h2>Squad Registration</h2>
            <p class="mode-description">Assemble your 4-player team by selecting an empty slot below. Click an empty slot to open the registration form or a filled slot to edit your roster.</p>

            <div class="slots-container" id="team-slots">
                <!-- Team slots will be generated dynamically using JavaScript -->
            </div>

            <div class="complete-registration-container">
                <button class="btn complete-btn" id="complete-squad-registration">Complete Registration</button>
                <p>Click to finalize all team registrations and save the data</p>
            </div>
        </div>

        <!-- Solo Registration Screen -->
        <div id="solo-registration">
            <div class="button-container">
                <button class="btn back-btn" id="back-to-modes-solo">← Back to Mode Selection</button>
                <button class="btn cancel-btn" id="cancel-solo-registration">Cancel Registration</button>
            </div>

            <h2>Solo Registration</h2>
            <p class="mode-description">Claim your spot in the battle royale! Select an empty hexagonal slot to register a player. Each slot can have one player.</p>

            <div class="solo-slots-container" id="solo-slots">
                <!-- Solo slots will be generated dynamically using JavaScript -->
            </div>

            <div class="complete-registration-container">
                <button class="btn complete-btn" id="complete-solo-registration">Complete Registration</button>
                <p>Click to finalize all player registrations and save the data</p>
            </div>
        </div>

        <!-- Squad Registration Modal -->
        <div class="modal" id="squad-registration-modal">
            <div class="modal-content">
                <span class="close-btn" id="close-squad-modal">&times;</span>
                <h2 class="modal-title">Team Registration - Slot <span id="current-squad-slot-number"></span></h2>

                <form class="registration-form" id="squad-registration-form">
                    <div class="player-section">
                        <h3>Captain Details (Player 1)</h3>

                        <div class="form-group">
                            <label for="team-name">Team Name <span class="required">*</span></label>
                            <input type="text" id="team-name" name="team-name" required>
                        </div>

                        <div class="form-group">
                            <label for="captain-ticket-id">Ticket ID <span class="required">*</span></label>
                            <input type="text" id="captain-ticket-id" name="captain-ticket-id" required>
                        </div>

                        <div class="form-group">
                            <label for="captain-ign">In-Game Name (IGN)</label>
                            <input type="text" id="captain-ign" name="captain-ign"
                                placeholder="Optional - Will default to Team-Player1">
                        </div>
                    </div>

                    <div class="player-section">
                        <h3>Player 2 Details</h3>

                        <div class="form-group">
                            <label for="player2-ticket-id">Ticket ID</label>
                            <input type="text" id="player2-ticket-id" name="player2-ticket-id"
                                placeholder="Optional - Will generate random number">
                        </div>

                        <div class="form-group">
                            <label for="player2-ign">In-Game Name (IGN)</label>
                            <input type="text" id="player2-ign" name="player2-ign"
                                placeholder="Optional - Will default to Team-Player2">
                        </div>
                    </div>

                    <div class="player-section">
                        <h3>Player 3 Details</h3>

                        <div class="form-group">
                            <label for="player3-ticket-id">Ticket ID</label>
                            <input type="text" id="player3-ticket-id" name="player3-ticket-id"
                                placeholder="Optional - Will generate random number">
                        </div>

                        <div class="form-group">
                            <label for="player3-ign">In-Game Name (IGN)</label>
                            <input type="text" id="player3-ign" name="player3-ign"
                                placeholder="Optional - Will default to Team-Player3">
                        </div>
                    </div>

                    <div class="player-section">
                        <h3>Player 4 Details</h3>

                        <div class="form-group">
                            <label for="player4-ticket-id">Ticket ID</label>
                            <input type="text" id="player4-ticket-id" name="player4-ticket-id"
                                placeholder="Optional - Will generate random number">
                        </div>

                        <div class="form-group">
                            <label for="player4-ign">In-Game Name (IGN)</label>
                            <input type="text" id="player4-ign" name="player4-ign"
                                placeholder="Optional - Will default to Team-Player4">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn submit-btn">Register Team</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Solo Registration Modal -->
        <div class="modal" id="solo-registration-modal">
            <div class="modal-content">
                <span class="close-btn" id="close-solo-modal">&times;</span>
                <h2 class="modal-title">Player Registration - Slot <span id="current-solo-slot-number"></span></h2>

                <form class="registration-form" id="solo-registration-form">
                    <div class="player-section">
                        <h3>Player Details</h3>

                        <div class="form-group">
                            <label for="solo-team-name">Team Name <span class="required">*</span></label>
                            <input type="text" id="solo-team-name" name="solo-team-name" required>
                        </div>

                        <div class="form-group">
                            <label for="solo-ticket-id">Ticket ID <span class="required">*</span></label>
                            <input type="text" id="solo-ticket-id" name="solo-ticket-id" required>
                        </div>

                        <div class="form-group">
                            <label for="solo-ign">In-Game Name (IGN)</label>
                            <input type="text" id="solo-ign" name="solo-ign"
                                placeholder="Optional - Will default to TeamName-player1">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn submit-btn">Register Player</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Export Modal -->
        <div class="modal" id="export-modal">
            <div class="modal-content">
                <span class="close-btn" id="close-export-modal">&times;</span>
                <h2 class="modal-title">Registration Complete</h2>
                <p style="text-align: center; margin-bottom: 20px; color:white;">All registrations have been saved. Would you like to
                    export the data?</p>

                <div class="export-options">
                    <button class="btn export-btn json-btn" id="export-json">Export as JSON</button>
                    <button class="btn export-btn csv-btn" id="export-csv">Export as CSV</button>
                </div>

                <div class="form-actions" style="margin-top: 30px;">
                    <button class="btn" id="return-to-modes" style="color: black;">Return to Mode Selection</button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast-notification"></div>
    </div>

        <script>
        // --- ADD YOUR GOOGLE APPS SCRIPT URL HERE ---
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwPh2RVxVCJu4Ggdom8ONNvLEdMBfENk8zSuTCxHQeQ6BXEdim0zB3K0JcHkS19-BA4aA/exec'; 

        // DOM Elements
        const modeSelection = document.getElementById('mode-selection');
        const squadRegistration = document.getElementById('squad-registration');
        const soloRegistration = document.getElementById('solo-registration');
        const squadModeBtn = document.getElementById('squad-mode');
        const soloModeBtn = document.getElementById('solo-mode');
        const backToModesSquadBtn = document.getElementById('back-to-modes-squad');
        const backToModesSoloBtn = document.getElementById('back-to-modes-solo');
        const cancelSquadBtn = document.getElementById('cancel-squad-registration');
        const cancelSoloBtn = document.getElementById('cancel-solo-registration');
        const teamSlots = document.getElementById('team-slots');
        const soloSlots = document.getElementById('solo-slots');
        const squadRegistrationModal = document.getElementById('squad-registration-modal');
        const soloRegistrationModal = document.getElementById('solo-registration-modal');
        const closeSquadModalBtn = document.getElementById('close-squad-modal');
        const closeSoloModalBtn = document.getElementById('close-solo-modal');
        const squadRegistrationForm = document.getElementById('squad-registration-form');
        const soloRegistrationForm = document.getElementById('solo-registration-form');
        const currentSquadSlotNumber = document.getElementById('current-squad-slot-number');
        const currentSoloSlotNumber = document.getElementById('current-solo-slot-number');
        const toastNotification = document.getElementById('toast-notification');
        const completeSquadRegistrationBtn = document.getElementById('complete-squad-registration');
        const completeSoloRegistrationBtn = document.getElementById('complete-solo-registration');
        const exportModal = document.getElementById('export-modal');
        const closeExportModalBtn = document.getElementById('close-export-modal');
        const exportJsonBtn = document.getElementById('export-json');
        const exportCsvBtn = document.getElementById('export-csv');
        const returnToModesBtn = document.getElementById('return-to-modes');

        // Global variables
        let currentSquadSlot = null;
        let currentSoloSlot = null;
        let currentMode = null;
        let squadTeams = [];
        let soloPlayers = [];

        // Function to change background based on current page
        function changeBackground(page) {
            document.body.classList.remove('mode-selection-bg', 'squad-registration-bg', 'solo-registration-bg');
            switch (page) {
                case 'mode-selection':
                    document.body.classList.add('mode-selection-bg');
                    break;
                case 'squad':
                    document.body.classList.add('squad-registration-bg');
                    break;
                case 'solo':
                    document.body.classList.add('solo-registration-bg');
                    break;
            }
        }

        // Cancel registration functions
        function cancelSquadRegistration() {
            if (confirm('Are you sure you want to cancel all squad registrations? This will clear all data.')) {
                squadTeams = [];
                saveSquadTeams();
                initializeSquadSlots();
                showToast('Squad registration cancelled. All data has been cleared.');
            }
        }

        function cancelSoloRegistration() {
            if (confirm('Are you sure you want to cancel all solo registrations? This will clear all data.')) {
                soloPlayers = [];
                saveSoloPlayers();
                initializeSoloSlots();
                showToast('Solo registration cancelled. All data has been cleared.');
            }
        }

        function generateRandomId() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // --- MODIFIED SQUAD SLOTS INITIALIZATION ---
        function initializeSquadSlots() {
            teamSlots.innerHTML = '';
            for (let i = 2; i <= 17; i++) {
                const slotHTML = `
            <div class="slot" data-slot="${i}">
                <div>
                    <div class="slot-header">
                        <div class="slot-number">${i}</div>
                        <div class="slot-team-name empty">Empty Slot</div>
                    </div>
                    <div class="player-pods">
                        <div class="player-pod" id="slot-${i}-player-1"><span class="player-pod-ign">Player 1 Vacant</span></div>
                        <div class="player-pod" id="slot-${i}-player-2"><span class="player-pod-ign">Player 2 Vacant</span></div>
                        <div class="player-pod" id="slot-${i}-player-3"><span class="player-pod-ign">Player 3 Vacant</span></div>
                        <div class="player-pod" id="slot-${i}-player-4"><span class="player-pod-ign">Player 4 Vacant</span></div>
                    </div>
                </div>

                <button class="add-team-btn">Assemble Squad</button>
                
                <div class="slot-filled-content">
                     <button class="edit-roster-btn">Edit Roster</button>
                     <div class="slot-booked-status">✔ Slot Booked</div>
                </div>
            </div>
        `;
                teamSlots.innerHTML += slotHTML;
            }

            document.querySelectorAll('.slot').forEach(btn => {
                btn.addEventListener('click', openSquadRegistrationModal);
            });
            updateSquadSlotsUI();
        }

        // --- MODIFIED SOLO SLOTS INITIALIZATION ---
        function initializeSoloSlots() {
            soloSlots.innerHTML = '';
            for (let i = 1; i <= 64; i++) {
                const slotHTML = `
            <div class="solo-slot" data-slot="${i}">
                <div class="solo-slot-inner">
                    <div class="solo-slot-number">${i}</div>
                    <div class="solo-player-info">
                        <div class="solo-player-icon">
                            <img src="icon.png" alt="Player Icon">
                        </div>
                        <div class="solo-player-name"></div>
                        <button class="edit-player-btn">Edit</button>
                        <div class="slot-booked-status">✔ Slot Booked</div>
                    </div>
                    <button class="add-player-btn">+</button>
                </div>
            </div>
        `;
                soloSlots.innerHTML += slotHTML;
            }

            document.querySelectorAll('.solo-slot').forEach(btn => {
                btn.addEventListener('click', openSoloRegistrationModal);
            });
            updateSoloSlotsUI();
        }

        function showToast(message, isError = false) {
            toastNotification.textContent = message;
            toastNotification.classList.add('show');
            toastNotification.classList.toggle('error', isError);

            setTimeout(() => {
                toastNotification.classList.remove('show');
            }, 3000);
        }

        function openSquadRegistrationModal(event) {
            const slotElement = event.target.closest('.slot');
            currentSquadSlot = slotElement.dataset.slot;
            currentSquadSlotNumber.textContent = currentSquadSlot;
            squadRegistrationForm.reset();

            const existingTeam = squadTeams.find(team => team.slot === currentSquadSlot);
            if (existingTeam) {
                document.getElementById('team-name').value = existingTeam.teamName;
                document.getElementById('captain-ticket-id').value = existingTeam.captain.ticketId;
                document.getElementById('captain-ign').value = existingTeam.captain.ign;
                document.getElementById('player2-ticket-id').value = existingTeam.player2.ticketId;
                document.getElementById('player2-ign').value = existingTeam.player2.ign;
                document.getElementById('player3-ticket-id').value = existingTeam.player3.ticketId;
                document.getElementById('player3-ign').value = existingTeam.player3.ign;
                document.getElementById('player4-ticket-id').value = existingTeam.player4.ticketId;
                document.getElementById('player4-ign').value = existingTeam.player4.ign;
            }
            squadRegistrationModal.style.display = 'block';
        }

        function openSoloRegistrationModal(event) {
            const slotElement = event.target.closest('.solo-slot');
            currentSoloSlot = slotElement.dataset.slot;
            currentSoloSlotNumber.textContent = currentSoloSlot;
            soloRegistrationForm.reset();

            const existingPlayer = soloPlayers.find(player => player.slot === currentSoloSlot);
            if (existingPlayer) {
                document.getElementById('solo-team-name').value = existingPlayer.teamName;
                document.getElementById('solo-ticket-id').value = existingPlayer.ticketId;
                document.getElementById('solo-ign').value = existingPlayer.ign;
            }
            soloRegistrationModal.style.display = 'block';
        }

        function closeSquadRegistrationModal() {
            squadRegistrationModal.style.display = 'none';
            currentSquadSlot = null;
        }

        function closeSoloRegistrationModal() {
            soloRegistrationModal.style.display = 'none';
            currentSoloSlot = null;
        }

        function handleSquadFormSubmit(event) {
            event.preventDefault();
            const teamName = document.getElementById('team-name').value.trim();
            const captainTicketId = document.getElementById('captain-ticket-id').value.trim();
            if (!teamName || !captainTicketId) {
                showToast('Please fill all required fields!', true);
                return;
            }

            const teamData = {
                slot: currentSquadSlot,
                teamName: teamName,
                registrationTime: new Date().toISOString(),
                captain: {
                    ticketId: captainTicketId,
                    ign: document.getElementById('captain-ign').value.trim() || `${teamName}-player1`
                },
                player2: {
                    ticketId: document.getElementById('player2-ticket-id').value.trim() || generateRandomId(),
                    ign: document.getElementById('player2-ign').value.trim() || `${teamName}-player2`
                },
                player3: {
                    ticketId: document.getElementById('player3-ticket-id').value.trim() || generateRandomId(),
                    ign: document.getElementById('player3-ign').value.trim() || `${teamName}-player3`
                },
                player4: {
                    ticketId: document.getElementById('player4-ticket-id').value.trim() || generateRandomId(),
                    ign: document.getElementById('player4-ign').value.trim() || `${teamName}-player4`
                }
            };

            const existingTeamIndex = squadTeams.findIndex(team => team.slot === currentSquadSlot);
            if (existingTeamIndex !== -1) squadTeams[existingTeamIndex] = teamData;
            else squadTeams.push(teamData);

            saveSquadTeams();
            updateSquadSlotsUI();
            showToast(`Team "${teamName}" successfully registered for Slot ${currentSquadSlot}!`);
            closeSquadRegistrationModal();
        }

        function handleSoloFormSubmit(event) {
            event.preventDefault();
            const teamName = document.getElementById('solo-team-name').value.trim();
            const ticketId = document.getElementById('solo-ticket-id').value.trim();
            if (!teamName || !ticketId) {
                showToast('Please fill all required fields!', true);
                return;
            }

            const playerData = {
                slot: currentSoloSlot,
                teamName: teamName,
                ticketId: ticketId,
                ign: document.getElementById('solo-ign').value.trim() || `${teamName}-player1`,
                registrationTime: new Date().toISOString()
            };

            const existingPlayerIndex = soloPlayers.findIndex(player => player.slot === currentSoloSlot);
            if (existingPlayerIndex !== -1) soloPlayers[existingPlayerIndex] = playerData;
            else soloPlayers.push(playerData);

            saveSoloPlayers();
            updateSoloSlotsUI();
            showToast(`Player "${teamName}" successfully registered for Slot ${currentSoloSlot}!`);
            closeSoloRegistrationModal();
        }

        function saveSquadTeams() {
            localStorage.setItem('bgmiSquadTeams', JSON.stringify(squadTeams));
        }

        function saveSoloPlayers() {
            localStorage.setItem('bgmiSoloPlayers', JSON.stringify(soloPlayers));
        }

        function loadSquadTeams() {
            const savedData = localStorage.getItem('bgmiSquadTeams');
            if (savedData) squadTeams = JSON.parse(savedData);
        }

        function loadSoloPlayers() {
            const savedData = localStorage.getItem('bgmiSoloPlayers');
            if (savedData) soloPlayers = JSON.parse(savedData);
        }

        // --- MODIFIED SQUAD UI UPDATE ---
        function updateSquadSlotsUI() {
            document.querySelectorAll('.slot').forEach(slot => {
                const slotNumber = slot.dataset.slot;
                const team = squadTeams.find(t => t.slot === slotNumber);

                const teamNameElement = slot.querySelector('.slot-team-name');
                const player1Pod = slot.querySelector(`#slot-${slotNumber}-player-1`);
                const player2Pod = slot.querySelector(`#slot-${slotNumber}-player-2`);
                const player3Pod = slot.querySelector(`#slot-${slotNumber}-player-3`);
                const player4Pod = slot.querySelector(`#slot-${slotNumber}-player-4`);

                if (team) {
                    slot.classList.add('filled');
                    teamNameElement.textContent = team.teamName;
                    teamNameElement.classList.remove('empty');
                    player1Pod.querySelector('.player-pod-ign').textContent = team.captain.ign;
                    player1Pod.classList.add('filled');
                    player2Pod.querySelector('.player-pod-ign').textContent = team.player2.ign;
                    player2Pod.classList.add('filled');
                    player3Pod.querySelector('.player-pod-ign').textContent = team.player3.ign;
                    player3Pod.classList.add('filled');
                    player4Pod.querySelector('.player-pod-ign').textContent = team.player4.ign;
                    player4Pod.classList.add('filled');
                } else {
                    slot.classList.remove('filled');
                    teamNameElement.textContent = 'Empty Slot';
                    teamNameElement.classList.add('empty');
                    player1Pod.querySelector('.player-pod-ign').textContent = 'Player 1 Vacant';
                    player1Pod.classList.remove('filled');
                    player2Pod.querySelector('.player-pod-ign').textContent = 'Player 2 Vacant';
                    player2Pod.classList.remove('filled');
                    player3Pod.querySelector('.player-pod-ign').textContent = 'Player 3 Vacant';
                    player3Pod.classList.remove('filled');
                    player4Pod.querySelector('.player-pod-ign').textContent = 'Player 4 Vacant';
                    player4Pod.classList.remove('filled');
                }
            });
        }

        // --- MODIFIED SOLO UI UPDATE ---
        function updateSoloSlotsUI() {
            document.querySelectorAll('.solo-slot').forEach(slot => {
                const slotNumber = slot.dataset.slot;
                const player = soloPlayers.find(p => p.slot === slotNumber);

                if (player) {
                    slot.classList.add('filled');
                    slot.querySelector('.solo-player-name').textContent = player.teamName;
                } else {
                    slot.classList.remove('filled');
                    slot.querySelector('.solo-player-name').textContent = '';
                }
            });
        }
        
        // --- UPDATED COMPLETE REGISTRATION FUNCTION ---
        function completeRegistration(mode) {
            let exportData;
            if (mode === 'squad') {
                exportData = { mode: 'squad', teams: squadTeams };
            } else if (mode === 'solo') {
                exportData = { mode: 'solo', players: soloPlayers };
            }

            // Show a loading toast
            showToast('Submitting data to Google Sheet...');

            // Send data to Google Apps Script
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // Important for cross-origin requests to Apps Script
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(exportData)
            })
            .then(response => {
                 // Even with no-cors, we assume success if the request doesn't throw an error
                console.log('Successfully sent data to Google Sheet.');
                showToast('Data successfully saved to Google Sheet!');
                 // Also save locally and show export modal
                const timestamp = new Date().toISOString();
                localStorage.setItem(`bgmiRegistration_${timestamp}`, JSON.stringify(exportData));
                exportModal.style.display = 'block';
            })
            .catch(error => {
                console.error('Error sending data to Google Sheet:', error);
                showToast('Error saving data to Google Sheet!', true);
            });
        }


        function exportAsJSON(data) {
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            const exportFileName = `bgmi_registration_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileName);
            linkElement.click();
        }

        function exportAsCSV(data) {
            let csvContent = '';
            if (data.mode === 'squad') {
                csvContent = 'Slot,Team Name,Registration Time,Captain Ticket ID,Captain IGN,Player2 Ticket ID,Player2 IGN,Player3 Ticket ID,Player3 IGN,Player4 Ticket ID,Player4 IGN\n';
                data.teams.forEach(team => {
                    const row = [team.slot, `"${team.teamName}"`, team.registrationTime, team.captain.ticketId, `"${team.captain.ign}"`, team.player2.ticketId, `"${team.player2.ign}"`, team.player3.ticketId, `"${team.player3.ign}"`, team.player4.ticketId, `"${team.player4.ign}"`].join(',');
                    csvContent += row + '\n';
                });
            } else if (data.mode === 'solo') {
                csvContent = 'Slot,Team Name,Ticket ID,IGN,Registration Time\n';
                data.players.forEach(player => {
                    const row = [player.slot, `"${player.teamName}"`, player.ticketId, `"${player.ign}"`, player.registrationTime].join(',');
                    csvContent += row + '\n';
                });
            }
            const encodedUri = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
            const exportFileName = `bgmi_registration_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.csv`;
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', encodedUri);
            linkElement.setAttribute('download', exportFileName);
            linkElement.click();
        }

        function resetRegistration() {
            if (currentMode === 'squad') {
                squadTeams = [];
                saveSquadTeams();
                initializeSquadSlots();
            } else if (currentMode === 'solo') {
                soloPlayers = [];
                saveSoloPlayers();
                initializeSoloSlots();
            }
            squadRegistration.style.display = 'none';
            soloRegistration.style.display = 'none';
            modeSelection.style.display = 'flex';
            exportModal.style.display = 'none';
            changeBackground('mode-selection');
            showToast('Registration data has been reset.');
        }

        // Event Listeners
        squadModeBtn.addEventListener('click', () => {
            modeSelection.style.display = 'none';
            squadRegistration.style.display = 'block';
            currentMode = 'squad';
            changeBackground('squad');
            loadSquadTeams();
            initializeSquadSlots();
        });

        soloModeBtn.addEventListener('click', () => {
            modeSelection.style.display = 'none';
            soloRegistration.style.display = 'block';
            currentMode = 'solo';
            changeBackground('solo');
            loadSoloPlayers();
            initializeSoloSlots();
        });

        backToModesSquadBtn.addEventListener('click', () => {
            squadRegistration.style.display = 'none';
            modeSelection.style.display = 'flex';
            changeBackground('mode-selection');
        });

        backToModesSoloBtn.addEventListener('click', () => {
            soloRegistration.style.display = 'none';
            modeSelection.style.display = 'flex';
            changeBackground('mode-selection');
        });

        cancelSquadBtn.addEventListener('click', cancelSquadRegistration);
        cancelSoloBtn.addEventListener('click', cancelSoloRegistration);
        closeSquadModalBtn.addEventListener('click', closeSquadRegistrationModal);
        closeSoloModalBtn.addEventListener('click', closeSoloRegistrationModal);
        squadRegistrationForm.addEventListener('submit', handleSquadFormSubmit);
        soloRegistrationForm.addEventListener('submit', handleSoloFormSubmit);

        completeSquadRegistrationBtn.addEventListener('click', () => {
            if (squadTeams.length === 0) {
                showToast('Register at least one team!', true);
                return;
            }
            completeRegistration('squad');
        });

        completeSoloRegistrationBtn.addEventListener('click', () => {
            if (soloPlayers.length === 0) {
                showToast('Register at least one player!', true);
                return;
            }
            completeRegistration('solo');
        });

        const getLatestExportData = () => {
            const latestKey = Object.keys(localStorage).filter(key => key.startsWith('bgmiRegistration_')).sort().pop();
            return latestKey ? JSON.parse(localStorage.getItem(latestKey)) : null;
        };

        closeExportModalBtn.addEventListener('click', () => exportModal.style.display = 'none');
        exportJsonBtn.addEventListener('click', () => exportAsJSON(getLatestExportData()));
        exportCsvBtn.addEventListener('click', () => exportAsCSV(getLatestExportData()));
        returnToModesBtn.addEventListener('click', resetRegistration);

        window.addEventListener('click', (event) => {
            if (event.target === squadRegistrationModal) closeSquadRegistrationModal();
            if (event.target === soloRegistrationModal) closeSoloRegistrationModal();
            if (event.target === exportModal) exportModal.style.display = 'none';
        });

        document.addEventListener('DOMContentLoaded', () => {
            loadSquadTeams();
            loadSoloPlayers();
            changeBackground('mode-selection');
        });
    </script>
</body>

</html>